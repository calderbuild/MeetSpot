<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeetSpot (ËÅöÁÇπ) - Êô∫ËÉΩ‰ºöÈù¢ÁÇπÊé®Ëçê</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv name="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <!-- Urban Navigator Theme Fonts - Distinctive Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Design Token System -->
    <link rel="stylesheet" href="/static/css/design-tokens.css">

    <!-- Modern UI Components -->
    <link rel="stylesheet" href="/public/css/components.css">

    <style>
        :root {
            --navy-900: #001524;
            --navy-800: #0A2540;
            --navy-700: #0A4D68;
            --navy-600: #0D5C7D;
            --coral-500: #FF6B35;
            --coral-400: #FF8C5A;
            --coral-300: #FFAD85;
            --mint-500: #06D6A0;
            --mint-400: #2EE5B5;
            --cream-100: #FFF8F3;
            --cream-200: #FFF0E6;
            --slate-100: #F1F5F9;
            --slate-200: #E2E8F0;
            --slate-400: #94A3B8;
            --slate-600: #475569;
            --slate-800: #1E293B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(165deg, var(--navy-900) 0%, var(--navy-800) 40%, var(--navy-700) 100%);
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
            color: var(--slate-800);
        }

        /* Animated topographic background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                repeating-radial-gradient(circle at 25% 25%, transparent 0, transparent 50px, rgba(255, 107, 53, 0.03) 50px, rgba(255, 107, 53, 0.03) 52px),
                repeating-radial-gradient(circle at 75% 75%, transparent 0, transparent 70px, rgba(6, 214, 160, 0.03) 70px, rgba(6, 214, 160, 0.03) 72px);
            background-size: 400px 400px;
            animation: topoFloat 80s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            top: -50%;
            right: -20%;
            width: 80%;
            height: 80%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        @keyframes topoFloat {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--coral-400);
            border-radius: 50%;
            opacity: 0;
            animation: particleFloat 15s ease-in-out infinite;
        }

        .particle:nth-child(1) { left: 10%; animation-delay: 0s; background: var(--coral-400); }
        .particle:nth-child(2) { left: 20%; animation-delay: 2s; background: var(--mint-400); }
        .particle:nth-child(3) { left: 30%; animation-delay: 4s; background: var(--coral-300); }
        .particle:nth-child(4) { left: 40%; animation-delay: 6s; background: var(--mint-500); }
        .particle:nth-child(5) { left: 50%; animation-delay: 8s; background: var(--coral-500); }
        .particle:nth-child(6) { left: 60%; animation-delay: 10s; background: var(--mint-400); }
        .particle:nth-child(7) { left: 70%; animation-delay: 12s; background: var(--coral-400); }
        .particle:nth-child(8) { left: 80%; animation-delay: 14s; background: var(--mint-500); }
        .particle:nth-child(9) { left: 90%; animation-delay: 1s; background: var(--coral-300); }
        .particle:nth-child(10) { left: 15%; animation-delay: 3s; background: var(--mint-400); }

        @keyframes particleFloat {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) scale(1); opacity: 0; }
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Outfit', 'PingFang SC', sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        /* Navigation Bar */
        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: rgba(0, 21, 36, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .nav-home {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4);
        }

        .nav-home i {
            font-size: 18px;
        }

        .nav-links {
            display: flex;
            gap: 24px;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--mint-500);
        }

        @media (max-width: 600px) {
            .nav-links {
                display: none;
            }
            .nav-bar {
                justify-content: center;
            }
        }

        .container {
            max-width: 920px;
            margin: 0 auto;
            padding: 24px 20px;
            padding-top: 80px; /* Account for fixed nav */
            position: relative;
            z-index: 1;
        }

        /* Header with animated gradient */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 32px;
            padding: 40px 20px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.15) 0%, transparent 70%);
            pointer-events: none;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.35);
            animation: logoPulse 4s ease-in-out infinite;
            position: relative;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 22px;
            background: linear-gradient(135deg, var(--coral-500), var(--mint-500), var(--coral-400));
            z-index: -1;
            opacity: 0.5;
            animation: logoGlow 4s ease-in-out infinite;
            filter: blur(8px);
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(2deg); }
            75% { transform: scale(1.05) rotate(-2deg); }
        }

        @keyframes logoGlow {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, var(--cream-200) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.85;
            font-weight: 400;
            color: var(--slate-200);
        }

        /* Enhanced Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 22px;
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(10px);
            border-radius: 100px;
            color: rgba(255, 255, 255, 0.45);
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
        }

        .step::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .step:hover::before {
            opacity: 1;
        }

        .step.active {
            background: rgba(255, 107, 53, 0.15);
            color: var(--coral-400);
            border-color: rgba(255, 107, 53, 0.5);
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.2);
        }

        .step.completed {
            background: rgba(6, 214, 160, 0.15);
            color: var(--mint-400);
            border-color: rgba(6, 214, 160, 0.5);
            box-shadow: 0 0 15px rgba(6, 214, 160, 0.15);
        }

        .step-number {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: currentColor;
            color: var(--navy-900);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: var(--coral-500);
            color: white;
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.5);
        }

        .step.completed .step-number {
            background: var(--mint-500);
            color: white;
            box-shadow: 0 0 12px rgba(6, 214, 160, 0.4);
        }

        .step.completed .step-number::after {
            content: '\2713';
            font-size: 0.8rem;
        }

        .step-connector {
            width: 40px;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .step-connector::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--mint-500), var(--coral-400));
            transition: width 0.5s ease;
            border-radius: 2px;
        }

        .step.completed + .step-connector::after {
            width: 100%;
        }

        /* Form Card - Glass morphism with entrance animation */
        .form-card {
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            box-shadow:
                0 4px 6px rgba(0, 0, 0, 0.05),
                0 20px 50px rgba(0, 21, 36, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            opacity: 0;
            animation: cardEnter 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s forwards;
            transform: translateY(30px);
        }

        @keyframes cardEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Section Styling */
        .section {
            margin-bottom: 40px;
            position: relative;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .section-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
            transition: all 0.3s ease;
            position: relative;
        }

        .section-icon::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--mint-500) 100%);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .section:hover .section-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .section:hover .section-icon::after {
            opacity: 0.3;
        }

        .section h3 {
            font-size: 1.25rem;
            color: var(--slate-800);
            font-weight: 700;
        }

        .section-subtitle {
            font-size: 0.85rem;
            color: var(--slate-400);
            margin-top: 2px;
        }

        /* Location Inputs */
        .locations-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .location-input {
            position: relative;
            animation: slideInUp 0.4s ease-out forwards;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .location-input input {
            width: 100%;
            padding: 16px 20px 16px 52px;
            border: 2px solid var(--slate-200);
            border-radius: 14px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }

        .location-input input:focus {
            outline: none;
            border-color: var(--coral-500);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.12), 0 4px 20px rgba(255, 107, 53, 0.1);
            background: linear-gradient(to bottom, white, #FFFBF8);
        }

        .location-input input::placeholder {
            color: var(--slate-400);
        }

        .location-input > i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--coral-500);
            font-size: 1.3rem;
        }

        .remove-location-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--cream-100);
            border: none;
            color: var(--slate-400);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .remove-location-btn:hover {
            background: #FEE2E2;
            color: #EF4444;
        }

        .location-hint {
            text-align: center;
            padding: 10px 16px;
            font-size: 0.875rem;
            border-radius: 10px;
            color: var(--slate-600);
            background: var(--slate-100);
            border: 1px solid var(--slate-200);
            transition: all 0.3s ease;
        }

        .location-hint.active {
            color: var(--coral-500);
            background: var(--cream-100);
            border-color: var(--coral-300);
        }

        .location-hint.limit {
            color: #DC2626;
            background: #FEF2F2;
            border-color: #FECACA;
        }

        .add-location-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--navy-700) 0%, var(--navy-800) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(10, 37, 64, 0.2);
        }

        .add-location-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(10, 37, 64, 0.3);
        }

        .add-location-btn i {
            font-size: 1.1rem;
        }

        /* Venue Type Categories */
        .venue-categories {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .venue-category {
            background: var(--slate-100);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--slate-200);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--slate-200);
        }

        .category-icon {
            font-size: 1.2rem;
        }

        .category-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--slate-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .venue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .place-type {
            background: white;
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 16px 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            perspective: 1000px;
            opacity: 0;
            animation: venueCardEnter 0.5s ease-out forwards;
        }

        /* Staggered entrance animation for venue cards */
        .venue-grid .place-type:nth-child(1) { animation-delay: 0.05s; }
        .venue-grid .place-type:nth-child(2) { animation-delay: 0.1s; }
        .venue-grid .place-type:nth-child(3) { animation-delay: 0.15s; }
        .venue-grid .place-type:nth-child(4) { animation-delay: 0.2s; }

        @keyframes venueCardEnter {
            from {
                opacity: 0;
                transform: translateY(15px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .place-type::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .place-type::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
            border-radius: 50%;
            z-index: 0;
        }

        .place-type:hover::after {
            width: 200px;
            height: 200px;
        }

        .place-type:hover {
            transform: translateY(-6px) rotateX(5deg);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(255, 107, 53, 0.1);
            border-color: var(--coral-300);
        }

        .place-type:active {
            transform: translateY(-2px) scale(0.98);
            transition: all 0.1s ease;
        }

        .place-type.selected {
            border-color: var(--coral-500);
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.25);
        }

        .place-type.selected::before {
            opacity: 1;
        }

        .place-type.selected i,
        .place-type.selected span {
            color: white;
            position: relative;
            z-index: 1;
        }

        .place-type i {
            font-size: 1.8rem;
            margin-bottom: 8px;
            display: block;
            color: var(--slate-600);
            transition: all 0.3s ease;
        }

        .place-type span {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--slate-700);
            transition: all 0.3s ease;
        }

        .selection-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 24px;
            height: 24px;
            background: var(--mint-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 2px 8px rgba(6, 214, 160, 0.4);
            z-index: 2;
        }

        .place-type.selected .selection-badge {
            opacity: 1;
            transform: scale(1);
        }

        .venue-hint {
            text-align: center;
            padding: 12px 16px;
            font-size: 0.875rem;
            border-radius: 10px;
            color: var(--slate-600);
            background: var(--cream-100);
            border: 1px dashed var(--coral-300);
            margin-top: 16px;
        }

        .venue-hint.active {
            color: var(--coral-500);
            border-style: solid;
            background: linear-gradient(135deg, var(--cream-100) 0%, var(--cream-200) 100%);
        }

        .venue-hint.limit {
            color: var(--mint-500);
            border-color: var(--mint-400);
            background: rgba(6, 214, 160, 0.1);
        }

        /* Custom Keywords */
        .custom-keywords {
            margin-top: 20px;
        }

        .custom-keywords input {
            width: 100%;
            padding: 16px 20px;
            border: 2px dashed var(--slate-300);
            border-radius: 14px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--slate-100);
        }

        .custom-keywords input:focus {
            outline: none;
            border-style: solid;
            border-color: var(--coral-500);
            background: white;
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1);
        }

        /* Filter Grid */
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .filter-group {
            background: var(--slate-100);
            padding: 18px;
            border-radius: 14px;
            border: 1px solid var(--slate-200);
        }

        .filter-group label {
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: 10px;
            display: block;
            font-size: 0.9rem;
        }

        .filter-group select {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--slate-200);
            border-radius: 10px;
            font-size: 0.95rem;
            font-family: inherit;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2394A3B8' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--coral-500);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        /* Requirements Section */
        .requirements-input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid var(--slate-200);
            border-radius: 14px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            background: white;
            line-height: 1.6;
        }

        .requirements-input:focus {
            outline: none;
            border-color: var(--coral-500);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1);
        }

        .suggestions {
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.08) 0%, rgba(6, 214, 160, 0.04) 100%);
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid rgba(6, 214, 160, 0.2);
        }

        .suggestions h4 {
            color: var(--slate-700);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            font-weight: 700;
        }

        .suggestions h4 i {
            color: var(--mint-500);
            font-size: 1.2rem;
        }

        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .suggestion-tag {
            background: var(--navy-700);
            color: white;
            padding: 10px 18px;
            border-radius: 100px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .suggestion-tag::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .suggestion-tag:hover::before {
            width: 200px;
            height: 200px;
        }

        .suggestion-tag:hover {
            background: var(--coral-500);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
        }

        .suggestion-tag:active {
            transform: translateY(-1px) scale(0.98);
        }

        .suggestion-tag.selected {
            background: var(--mint-500);
            border-color: var(--mint-400);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.3);
            transform: translateY(-2px);
        }

        .suggestion-tag.selected::after {
            content: '\2713';
            margin-left: 6px;
            font-size: 0.75rem;
        }

        /* Enhanced Submit Button */
        .submit-btn {
            width: 100%;
            padding: 22px 40px;
            background: linear-gradient(135deg, var(--coral-500) 0%, #E85A2A 50%, var(--coral-500) 100%);
            background-size: 200% 100%;
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.15rem;
            font-weight: 700;
            font-family: 'Outfit', 'Sora', sans-serif;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow:
                0 8px 32px rgba(255, 107, 53, 0.35),
                0 0 0 0 rgba(255, 107, 53, 0.4);
            letter-spacing: 0.02em;
            position: relative;
            overflow: hidden;
            animation: buttonPulse 3s ease-in-out infinite;
        }

        @keyframes buttonPulse {
            0%, 100% {
                box-shadow: 0 8px 32px rgba(255, 107, 53, 0.35), 0 0 0 0 rgba(255, 107, 53, 0.4);
            }
            50% {
                box-shadow: 0 8px 32px rgba(255, 107, 53, 0.35), 0 0 0 8px rgba(255, 107, 53, 0);
            }
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(255, 107, 53, 0.45);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .submit-btn i {
            font-size: 1.4rem;
        }

        /* ========== Enhanced Agent Thinking Experience ========== */
        .loading {
            display: none;
            text-align: center;
            padding: 48px 24px;
            color: var(--coral-500);
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Agent Brain Visualization */
        .agent-brain {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .agent-brain::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--coral-500), var(--mint-500), var(--navy-700), var(--coral-400), var(--coral-500));
            animation: brainSpin 2s linear infinite;
            filter: blur(2px);
        }

        .agent-brain::after {
            content: '';
            position: absolute;
            inset: 8px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,248,243,1) 100%);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }

        .agent-brain i {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: var(--coral-500);
            z-index: 1;
            animation: brainPulse 1.5s ease-in-out infinite;
        }

        @keyframes brainSpin {
            to { transform: rotate(360deg); }
        }

        @keyframes brainPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
        }

        /* Thinking Steps Container */
        .thinking-steps {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .thinking-step {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            background: var(--slate-100);
            border-radius: 14px;
            opacity: 0.4;
            transform: translateX(-10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .thinking-step.active {
            opacity: 1;
            transform: translateX(0);
            background: linear-gradient(135deg, rgba(255,107,53,0.08) 0%, rgba(255,107,53,0.03) 100%);
            border-color: var(--coral-300);
        }

        .thinking-step.completed {
            opacity: 1;
            transform: translateX(0);
            background: linear-gradient(135deg, rgba(6,214,160,0.08) 0%, rgba(6,214,160,0.03) 100%);
            border-color: var(--mint-400);
        }

        .step-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
            background: var(--slate-200);
            color: var(--slate-400);
            transition: all 0.3s ease;
        }

        .thinking-step.active .step-icon {
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            color: white;
            animation: iconPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .thinking-step.completed .step-icon {
            background: linear-gradient(135deg, var(--mint-500) 0%, var(--mint-400) 100%);
            color: white;
        }

        @keyframes iconPop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .step-content {
            flex: 1;
            text-align: left;
        }

        .step-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--slate-600);
            margin: 0 0 2px 0;
            transition: color 0.3s ease;
        }

        .thinking-step.active .step-title {
            color: var(--coral-500);
        }

        .thinking-step.completed .step-title {
            color: var(--mint-500);
        }

        .step-desc {
            font-size: 0.8rem;
            color: var(--slate-400);
            margin: 0;
        }

        /* Thought Bubble Effect */
        .thought-bubble {
            position: absolute;
            background: white;
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 0.75rem;
            color: var(--slate-600);
            box-shadow: 0 4px 16px rgba(0,21,36,0.1);
            opacity: 0;
            animation: bubbleFloat 3s ease-in-out infinite;
            white-space: nowrap;
            border: 1px solid var(--slate-200);
        }

        .thought-bubble::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 20px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,21,36,0.08);
        }

        .bubble-1 { top: -30px; right: -20px; animation-delay: 0s; }
        .bubble-2 { top: 10px; left: -40px; animation-delay: 1s; }
        .bubble-3 { bottom: -20px; right: -30px; animation-delay: 2s; }

        @keyframes bubbleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
            20%, 80% { opacity: 1; transform: translateY(-5px) scale(1); }
        }

        /* Loading Progress Bar */
        .loading-progress {
            width: 100%;
            height: 4px;
            background: var(--slate-200);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--coral-500), var(--mint-500));
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s ease-out;
        }

        /* Mode Badge */
        .mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mode-badge.agent {
            background: linear-gradient(135deg, var(--coral-500) 0%, var(--coral-400) 100%);
            color: white;
        }

        .mode-badge.fast {
            background: linear-gradient(135deg, var(--mint-500) 0%, var(--mint-400) 100%);
            color: white;
        }

        /* Legacy support */
        .loading-orb {
            display: none;
        }

        .loading-text h4 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--slate-800);
            margin: 0 0 4px 0;
        }

        .loading-text p {
            font-size: 0.9rem;
            color: var(--slate-500);
            margin: 0;
        }

        .loading-dots {
            display: none;
        }

        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                padding: 30px 16px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-card {
                padding: 24px 20px;
                border-radius: 20px;
            }

            .step-indicator {
                gap: 4px;
            }

            .step {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .step-connector {
                width: 16px;
            }

            .venue-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .place-type {
                padding: 12px 8px;
            }

            .place-type i {
                font-size: 1.5rem;
            }

            .place-type span {
                font-size: 0.8rem;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .suggestion-tags {
                gap: 8px;
            }

            .suggestion-tag {
                padding: 8px 14px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .venue-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .logo-icon {
                width: 48px;
                height: 48px;
                font-size: 24px;
            }

            .header h1 {
                font-size: 1.75rem;
            }
        }

        /* Address Autocomplete Dropdown Styles */
        .amap-sug-result {
            z-index: 9999 !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0, 21, 36, 0.15) !important;
            border: 1px solid var(--slate-200) !important;
            overflow: hidden !important;
        }

        .amap-sug-result .auto-item {
            padding: 12px 16px !important;
            border-bottom: 1px solid var(--slate-100) !important;
            transition: all 0.2s ease !important;
        }

        .amap-sug-result .auto-item:hover {
            background: linear-gradient(135deg, var(--cream-100) 0%, var(--cream-200) 100%) !important;
        }

        .amap-sug-result .auto-item.selected {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 107, 53, 0.05) 100%) !important;
        }

        .amap-sug-result .auto-item .poi-name {
            font-weight: 600 !important;
            color: var(--slate-800) !important;
        }

        .amap-sug-result .auto-item .poi-addr {
            font-size: 0.85rem !important;
            color: var(--slate-500) !important;
            margin-top: 2px !important;
        }

        /* Location input with selected indicator */
        .location-input.has-coord input {
            border-color: var(--mint-400) !important;
            background: linear-gradient(to bottom, white, rgba(6, 214, 160, 0.05)) !important;
        }

        .location-input .coord-indicator {
            position: absolute;
            right: 48px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: var(--mint-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .location-input.has-coord .coord-indicator {
            opacity: 1;
        }

        /* First two inputs don't have remove button, adjust indicator position */
        .location-input:not(:has(.remove-location-btn)) .coord-indicator {
            right: 12px;
        }
    </style>

    <script>
    var _hmt = _hmt || [];
    fetch("/api/config/analytics").then(function(r) { return r.json(); }).then(function(cfg) {
        if (cfg.baidu_tongji_id) {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?" + cfg.baidu_tongji_id;
            document.head.appendChild(hm);
        }
    }).catch(function() {});
    </script>
</head>
<body>
    <!-- Floating Particles Background -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <a href="/" class="nav-home">
            <i class='bx bx-home'></i>
            <span>È¶ñÈ°µ</span>
        </a>
        <div class="nav-links">
            <a href="/how-it-works">‰ΩøÁî®ÊåáÂçó</a>
            <a href="/faq">Â∏∏ËßÅÈóÆÈ¢ò</a>
            <a href="/about">ÂÖ≥‰∫éÊàë‰ª¨</a>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class='bx bxs-map-pin'></i>
                </div>
            </div>
            <h1>MeetSpot ËÅöÁÇπ</h1>
            <p>Êô∫ËÉΩ‰ºöÈù¢ÁÇπÊé®ËçêÁ≥ªÁªü - ËÆ©ÊØèÊ¨°ËÅö‰ºöÈÉΩÊâæÂà∞ÂÆåÁæéÂú∞ÁÇπ</p>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span>ËæìÂÖ•Âú∞ÁÇπ</span>
            </div>
            <div class="step-connector"></div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span>ÈÄâÊã©Âú∫ÊôØ</span>
            </div>
            <div class="step-connector"></div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span>Ëé∑ÂèñÊé®Ëçê</span>
            </div>
        </div>

        <div class="form-card">
            <form id="meetspotForm">
                <!-- Step 1: Locations -->
                <div class="section" data-section="1">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class='bx bxs-map-pin'></i>
                        </div>
                        <div>
                            <h3>ÂèÇ‰∏éËÄÖÂú∞ÁÇπ</h3>
                            <p class="section-subtitle">ËæìÂÖ•2-10‰∏™Âú∞ÁÇπÔºåÁ≥ªÁªüÂ∞ÜËÆ°ÁÆóÊúÄ‰Ω≥‰∏≠ÁÇπ</p>
                        </div>
                    </div>

                    <div class="locations-container" id="locationsContainer">
                        <div class="location-input" data-index="0">
                            <i class='bx bxs-location-plus'></i>
                            <input type="text" name="location" id="location-0" placeholder="ËæìÂÖ•Á¨¨‰∏Ä‰∏™Âú∞ÁÇπÔºåÂ¶ÇÔºöÂåó‰∫¨ÊúùÈò≥Âå∫Êúõ‰∫¨" required>
                            <span class="coord-indicator"><i class='bx bx-check'></i></span>
                        </div>
                        <div class="location-input" data-index="1">
                            <i class='bx bxs-location-plus'></i>
                            <input type="text" name="location" id="location-1" placeholder="ËæìÂÖ•Á¨¨‰∫å‰∏™Âú∞ÁÇπÔºåÂ¶ÇÔºöÊµ∑Ê∑ÄÂå∫‰∏≠ÂÖ≥Êùë" required>
                            <span class="coord-indicator"><i class='bx bx-check'></i></span>
                        </div>
                    </div>

                    <div id="location-count-hint" class="location-hint">
                        Â∑≤ËæìÂÖ•2‰∏™Âú∞ÁÇπÔºåÂèØÊ∑ªÂä†Êõ¥Â§öÔºàÊúÄÂ§ö10‰∏™Ôºâ
                    </div>

                    <button type="button" class="add-location-btn" onclick="addLocation()">
                        <i class='bx bx-plus-circle'></i>
                        Ê∑ªÂä†Êõ¥Â§öÂú∞ÁÇπ
                    </button>
                </div>

                <!-- Step 2: Venue Types -->
                <div class="section" data-section="2">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class='bx bxs-store'></i>
                        </div>
                        <div>
                            <h3>ÈÄâÊã©Âú∫ÊôØÁ±ªÂûã</h3>
                            <p class="section-subtitle">ÂèØÈÄâÊã©1-3ÁßçÂú∫ÊôØÔºåÊé®ËçêÊõ¥Á≤æÂáÜ</p>
                        </div>
                    </div>

                    <div class="venue-categories">
                        <!-- Food & Drinks -->
                        <div class="venue-category">
                            <div class="category-header">
                                <span class="category-icon">üçΩÔ∏è</span>
                                <span class="category-title">ÁæéÈ£üÈ•ÆÂìÅ</span>
                            </div>
                            <div class="venue-grid">
                                <div class="place-type" data-type="ÂíñÂï°È¶Ü" data-theme="coffee">
                                    <i class='bx bxs-coffee-togo'></i>
                                    <span>ÂíñÂï°È¶Ü</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="È§êÂéÖ" data-theme="restaurant">
                                    <i class='bx bx-food-menu'></i>
                                    <span>È§êÂéÖ</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="Ëå∂Ê•º" data-theme="teahouse">
                                    <i class='bx bxs-coffee-bean'></i>
                                    <span>Ëå∂Ê•º</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="ÈÖíÂêß" data-theme="bar">
                                    <i class='bx bxs-drink'></i>
                                    <span>ÈÖíÂêß</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                            </div>
                        </div>

                        <!-- Entertainment -->
                        <div class="venue-category">
                            <div class="category-header">
                                <span class="category-icon">üé¨</span>
                                <span class="category-title">‰ºëÈó≤Â®±‰πê</span>
                            </div>
                            <div class="venue-grid">
                                <div class="place-type" data-type="ÁîµÂΩ±Èô¢" data-theme="cinema">
                                    <i class='bx bxs-film'></i>
                                    <span>ÁîµÂΩ±Èô¢</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="KTV" data-theme="ktv">
                                    <i class='bx bxs-microphone'></i>
                                    <span>KTV</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="Ê∏∏ÊàèÂéÖ" data-theme="ktv">
                                    <i class='bx bxs-joystick'></i>
                                    <span>Ê∏∏ÊàèÂéÖ</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="ÂÅ•Ë∫´Êàø" data-theme="gym">
                                    <i class='bx bx-body'></i>
                                    <span>ÂÅ•Ë∫´Êàø</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                            </div>
                        </div>

                        <!-- Culture & Learning -->
                        <div class="venue-category">
                            <div class="category-header">
                                <span class="category-icon">üìö</span>
                                <span class="category-title">ÊñáÂåñÂ≠¶‰π†</span>
                            </div>
                            <div class="venue-grid">
                                <div class="place-type" data-type="Âõæ‰π¶È¶Ü" data-theme="library">
                                    <i class='bx bxs-book'></i>
                                    <span>Âõæ‰π¶È¶Ü</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="‰π¶Â∫ó" data-theme="library">
                                    <i class='bx bxs-book-open'></i>
                                    <span>‰π¶Â∫ó</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="ÂçöÁâ©È¶Ü" data-theme="museum">
                                    <i class='bx bxs-institution'></i>
                                    <span>ÂçöÁâ©È¶Ü</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="ÊôØÁÇπ" data-theme="attraction">
                                    <i class='bx bxs-landmark'></i>
                                    <span>ÊôØÁÇπ</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                            </div>
                        </div>

                        <!-- Shopping & Outdoor -->
                        <div class="venue-category">
                            <div class="category-header">
                                <span class="category-icon">üõçÔ∏è</span>
                                <span class="category-title">Ë¥≠Áâ©‰ºëÈó≤</span>
                            </div>
                            <div class="venue-grid">
                                <div class="place-type" data-type="ÂïÜÂú∫" data-theme="shopping">
                                    <i class='bx bxs-shopping-bag'></i>
                                    <span>ÂïÜÂú∫</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="Ë¥≠Áâ©‰∏≠ÂøÉ" data-theme="shopping">
                                    <i class='bx bxs-shopping-bags'></i>
                                    <span>Ë¥≠Áâ©‰∏≠ÂøÉ</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                                <div class="place-type" data-type="ÂÖ¨Âõ≠" data-theme="park">
                                    <i class='bx bxs-tree'></i>
                                    <span>ÂÖ¨Âõ≠</span>
                                    <div class="selection-badge"><i class='bx bx-check'></i></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="place-type-hint" class="venue-hint">
                        ËØ∑ÈÄâÊã©ÊÇ®ÂñúÊ¨¢ÁöÑÂú∫ÊôØÁ±ªÂûãÔºàÊúÄÂ§ö3‰∏™Ôºâ
                    </div>

                    <div class="custom-keywords">
                        <input type="text" id="customKeywords" placeholder="ÊàñËæìÂÖ•Ëá™ÂÆö‰πâÂÖ≥ÈîÆËØçÔºöÊ∏∏Ê≥≥È¶Ü„ÄÅÁëú‰ºΩÈ¶Ü„ÄÅÂØÜÂÆ§ÈÄÉËÑ±...">
                    </div>
                </div>

                <!-- Step 3: Filters -->
                <div class="section" data-section="3">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class='bx bxs-filter-alt'></i>
                        </div>
                        <div>
                            <h3>Á≠õÈÄâÊù°‰ª∂</h3>
                            <p class="section-subtitle">ÂèØÈÄâÔºåÂ∏ÆÂä©ÊÇ®ÊâæÂà∞Êõ¥ÂåπÈÖçÁöÑÂú∫ÊâÄ</p>
                        </div>
                    </div>

                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="minRating">ÊúÄ‰ΩéËØÑÂàÜ</label>
                            <select id="minRating">
                                <option value="0">‰∏çÈôêÂà∂</option>
                                <option value="3.0">3.0ÂàÜ‰ª•‰∏ä</option>
                                <option value="3.5">3.5ÂàÜ‰ª•‰∏ä</option>
                                <option value="4.0">4.0ÂàÜ‰ª•‰∏ä</option>
                                <option value="4.5">4.5ÂàÜ‰ª•‰∏ä</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="maxDistance">ÊúÄÂ§ßË∑ùÁ¶ª</label>
                            <select id="maxDistance">
                                <option value="100000">‰∏çÈôêÂà∂</option>
                                <option value="5000">5ÂÖ¨ÈáåÂÜÖ</option>
                                <option value="10000" selected>10ÂÖ¨ÈáåÂÜÖ</option>
                                <option value="20000">20ÂÖ¨ÈáåÂÜÖ</option>
                                <option value="30000">30ÂÖ¨ÈáåÂÜÖ</option>
                                <option value="50000">50ÂÖ¨ÈáåÂÜÖ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="priceRange">‰ª∑Ê†ºÂå∫Èó¥</label>
                            <select id="priceRange">
                                <option value="">‰∏çÈôêÂà∂</option>
                                <option value="economy">ÁªèÊµéÂÆûÊÉ†</option>
                                <option value="mid">‰∏≠Á≠âÊ∂àË¥π</option>
                                <option value="high">È´òÁ´ØÊ∂àË¥π</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Special Requirements -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class='bx bxs-star'></i>
                        </div>
                        <div>
                            <h3>ÁâπÊÆäÈúÄÊ±Ç</h3>
                            <p class="section-subtitle">ÂèØÈÄâÔºåÊèèËø∞ÊÇ®ÁöÑÁâπÊÆäË¶ÅÊ±Ç</p>
                        </div>
                    </div>

                    <textarea
                        id="userRequirements"
                        class="requirements-input"
                        placeholder="ËØ∑ÊèèËø∞ÊÇ®ÁöÑÁâπÊÆäÈúÄÊ±ÇÔºå‰æãÂ¶ÇÔºö&#10;‚Ä¢ ÂÅúËΩ¶Êñπ‰æø&#10;‚Ä¢ ÁéØÂ¢ÉÂÆâÈùô&#10;‚Ä¢ ÈÄÇÂêàÂïÜÂä°Ê¥ΩË∞à"
                    ></textarea>

                    <div class="suggestions">
                        <h4><i class='bx bx-bulb'></i>Â∏∏Áî®ÈúÄÊ±ÇÔºàÁÇπÂáªÊ∑ªÂä†Ôºâ</h4>
                        <div class="suggestion-tags">
                            <span class="suggestion-tag" onclick="addRequirement('ÂÅúËΩ¶Êñπ‰æø')">ÂÅúËΩ¶Êñπ‰æø</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÁéØÂ¢ÉÂÆâÈùô')">ÁéØÂ¢ÉÂÆâÈùô</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÊúâWi-Fi')">ÊúâWi-Fi</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÈÄÇÂêàÂïÜÂä°')">ÈÄÇÂêàÂïÜÂä°</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÈÄÇÂêàÂÑøÁ´•')">ÈÄÇÂêàÂÑøÁ´•</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÊúâÂåÖÈó¥')">ÊúâÂåÖÈó¥</span>
                            <span class="suggestion-tag" onclick="addRequirement('ÂèØ‰ª•‰πÖÂùê')">ÂèØ‰ª•‰πÖÂùê</span>
                            <span class="suggestion-tag" onclick="addRequirement('24Â∞èÊó∂Ëê•‰∏ö')">24Â∞èÊó∂Ëê•‰∏ö</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <i class='bx bx-search-alt-2'></i>
                    Êü•ÊâæÊúÄ‰Ω≥‰ºöÈù¢ÁÇπ
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="loading-container">
                    <!-- Agent Brain with Thought Bubbles -->
                    <div class="agent-brain">
                        <i class='bx bxs-brain'></i>
                        <span class="thought-bubble bubble-1">ÂàÜÊûê‰∏≠...</span>
                        <span class="thought-bubble bubble-2">ÊÄùËÄÉ...</span>
                        <span class="thought-bubble bubble-3">‰ºòÂåñ...</span>
                    </div>

                    <!-- Loading Text -->
                    <div class="loading-text">
                        <h4 id="loadingTitle">Êô∫ËÉΩÂàÜÊûê‰∏≠</h4>
                        <p id="loadingText">Ê≠£Âú®‰∏∫ÊÇ®ÂØªÊâæÊúÄ‰Ω≥‰ºöÈù¢ÁÇπ...</p>
                    </div>

                    <!-- Thinking Steps -->
                    <div class="thinking-steps" id="thinkingSteps">
                        <div class="thinking-step" data-step="1">
                            <div class="step-icon"><i class='bx bx-map-pin'></i></div>
                            <div class="step-content">
                                <p class="step-title">Ëß£ÊûêÂú∞ÂùÄ</p>
                                <p class="step-desc">Ëé∑ÂèñÂêÑ‰ΩçÁΩÆÂùêÊ†á‰ø°ÊÅØ</p>
                            </div>
                        </div>
                        <div class="thinking-step" data-step="2">
                            <div class="step-icon"><i class='bx bx-target-lock'></i></div>
                            <div class="step-content">
                                <p class="step-title">ËÆ°ÁÆó‰∏≠ÂøÉÁÇπ</p>
                                <p class="step-desc">ÂØªÊâæÊúÄÂÖ¨Âπ≥ÁöÑ‰ºöÈù¢‰ΩçÁΩÆ</p>
                            </div>
                        </div>
                        <div class="thinking-step" data-step="3">
                            <div class="step-icon"><i class='bx bx-search-alt'></i></div>
                            <div class="step-content">
                                <p class="step-title">ÊêúÁ¥¢Âë®ËæπÂú∫ÊâÄ</p>
                                <p class="step-desc">ÂèëÁé∞ÈôÑËøë‰ºòË¥®Âú∞ÁÇπ</p>
                            </div>
                        </div>
                        <div class="thinking-step" data-step="4">
                            <div class="step-icon"><i class='bx bx-analyse'></i></div>
                            <div class="step-content">
                                <p class="step-title">Êô∫ËÉΩËØÑÂàÜÊéíÂ∫è</p>
                                <p class="step-desc">ÁªºÂêàËØÑ‰º∞ÊúÄ‰Ω≥ÈÄâÊã©</p>
                            </div>
                        </div>
                        <div class="thinking-step" data-step="5">
                            <div class="step-icon"><i class='bx bx-check-double'></i></div>
                            <div class="step-content">
                                <p class="step-title">ÁîüÊàêÊé®Ëçê</p>
                                <p class="step-desc">‰∏∫ÊÇ®ÂÆöÂà∂‰∏ìÂ±ûÊñπÊ°à</p>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="loading-progress">
                        <div class="loading-progress-bar" id="loadingProgressBar"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedPlaceTypes = new Set();
        let selectedThemeOrder = [];
        const MAX_PLACE_TYPES = 3;

        // ========== Address Autocomplete State ==========
        let locationIndex = 2;  // Start from 2 since we have 0 and 1
        let locationCoords = {};  // Store selected coordinates: { inputId: { name, address, lng, lat, city } }
        let AMap = null;  // Will be set after AMap loads
        let autocompleteInstances = {};  // Store Autocomplete instances for cleanup

        // ========== AMap Loader ==========
        function loadAMapAPI() {
            return new Promise((resolve, reject) => {
                // Set security config
                window._AMapSecurityConfig = {
                    securityJsCode: window.AMAP_SECURITY_JS_CODE || ''
                };

                // Load AMap Loader
                const script = document.createElement('script');
                script.src = 'https://webapi.amap.com/loader.js';
                script.onload = function() {
                    // Fetch API key from server
                    fetch('/api/config/amap')
                        .then(r => r.json())
                        .then(config => {
                            window._AMapSecurityConfig.securityJsCode = config.security_js_code || '';
                            AMapLoader.load({
                                key: config.api_key,
                                version: "2.0",
                                plugins: ["AMap.AutoComplete", "AMap.PlaceSearch"]
                            })
                            .then(function(amap) {
                                AMap = amap;
                                console.log('AMap loaded successfully');
                                // Initialize autocomplete for existing inputs
                                initAllAutocomplete();
                                resolve(amap);
                            })
                            .catch(function(e) {
                                console.error('AMap load failed:', e);
                                reject(e);
                            });
                        })
                        .catch(err => {
                            console.warn('Failed to fetch AMap config, autocomplete disabled:', err);
                            resolve(null);
                        });
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Initialize autocomplete for a single input
        function initAutocomplete(inputId) {
            if (!AMap) {
                console.warn('AMap not loaded, skipping autocomplete init for', inputId);
                return;
            }

            const input = document.getElementById(inputId);
            if (!input) return;

            // Clean up existing instance
            if (autocompleteInstances[inputId]) {
                // AMap Autocomplete doesn't have a destroy method, but we can remove event listeners
                delete autocompleteInstances[inputId];
            }

            try {
                const autocomplete = new AMap.AutoComplete({
                    input: inputId,
                    datatype: 'all',
                    citylimit: false  // Search across all cities
                });

                autocompleteInstances[inputId] = autocomplete;

                // Handle selection
                AMap.Event.addListener(autocomplete, 'select', function(e) {
                    if (e.poi && e.poi.location) {
                        const locationInput = input.closest('.location-input');
                        locationCoords[inputId] = {
                            name: e.poi.name,
                            address: e.poi.address || e.poi.name,
                            lng: e.poi.location.lng,
                            lat: e.poi.location.lat,
                            city: e.poi.adcode ? '' : ''  // City will be in address
                        };
                        // Update input value to show selected name
                        input.value = e.poi.name;
                        // Add visual indicator
                        if (locationInput) {
                            locationInput.classList.add('has-coord');
                        }
                        console.log('Selected location:', locationCoords[inputId]);
                        updateStepIndicator();
                    }
                });

                // Clear coord when user types manually
                input.addEventListener('input', function() {
                    const locationInput = input.closest('.location-input');
                    // If user is typing (not selecting from dropdown), clear the stored coord
                    setTimeout(() => {
                        if (!locationCoords[inputId] || input.value !== locationCoords[inputId].name) {
                            delete locationCoords[inputId];
                            if (locationInput) {
                                locationInput.classList.remove('has-coord');
                            }
                        }
                    }, 100);
                });

                console.log('Autocomplete initialized for', inputId);
            } catch (err) {
                console.error('Failed to init autocomplete for', inputId, err);
            }
        }

        // Initialize autocomplete for all existing inputs
        function initAllAutocomplete() {
            document.querySelectorAll('input[name="location"]').forEach(input => {
                if (input.id) {
                    initAutocomplete(input.id);
                }
            });
        }

        // Step indicator update
        function updateStepIndicator() {
            const locations = document.querySelectorAll('input[name="location"]');
            const filledLocations = Array.from(locations).filter(input => input.value.trim()).length;

            const steps = document.querySelectorAll('.step');

            // Step 1: Locations
            if (filledLocations >= 2) {
                steps[0].classList.remove('active');
                steps[0].classList.add('completed');
                steps[1].classList.add('active');
            } else {
                steps[0].classList.add('active');
                steps[0].classList.remove('completed');
                steps[1].classList.remove('active');
            }

            // Step 2: Venue types
            if (selectedPlaceTypes.size > 0 || document.getElementById('customKeywords').value.trim()) {
                steps[1].classList.remove('active');
                steps[1].classList.add('completed');
                steps[2].classList.add('active');
            } else if (filledLocations >= 2) {
                steps[1].classList.add('active');
                steps[1].classList.remove('completed');
                steps[2].classList.remove('active');
            }
        }

        // Venue type selection
        document.querySelectorAll('.place-type').forEach(type => {
            type.addEventListener('click', function() {
                const typeValue = this.getAttribute('data-type');
                const themeValue = this.getAttribute('data-theme');

                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    selectedPlaceTypes.delete(typeValue);
                    selectedThemeOrder = selectedThemeOrder.filter(theme => theme !== themeValue);
                } else {
                    if (selectedPlaceTypes.size >= MAX_PLACE_TYPES) {
                        showWarning('Â∑≤Ëææ‰∏äÈôê', `ÊúÄÂ§öÈÄâÊã©${MAX_PLACE_TYPES}‰∏™Âú∫ÊôØÁ±ªÂûã`);
                        return;
                    }
                    this.classList.add('selected');
                    selectedPlaceTypes.add(typeValue);
                    if (themeValue && !selectedThemeOrder.includes(themeValue)) {
                        selectedThemeOrder.push(themeValue);
                    }
                }
                updatePlaceTypeHint();
                updateStepIndicator();
            });
        });

        // Custom keywords input
        document.getElementById('customKeywords').addEventListener('input', function() {
            if (this.value.trim()) {
                document.querySelectorAll('.place-type.selected').forEach(type => {
                    type.classList.remove('selected');
                });
                selectedPlaceTypes.clear();
                selectedThemeOrder = [];
                updatePlaceTypeHint();
            }
            updateStepIndicator();
        });

        // Location input listeners
        document.addEventListener('input', function(e) {
            if (e.target.name === 'location') {
                updateLocationCountHint();
                updateStepIndicator();
            }
        });

        function updatePlaceTypeHint() {
            const hintElement = document.getElementById('place-type-hint');
            if (!hintElement) return;

            const remaining = MAX_PLACE_TYPES - selectedPlaceTypes.size;
            if (selectedPlaceTypes.size === 0) {
                hintElement.textContent = `ËØ∑ÈÄâÊã©ÊÇ®ÂñúÊ¨¢ÁöÑÂú∫ÊôØÁ±ªÂûãÔºàÊúÄÂ§ö${MAX_PLACE_TYPES}‰∏™Ôºâ`;
                hintElement.className = 'venue-hint';
            } else if (remaining > 0) {
                hintElement.textContent = `Â∑≤ÈÄâÊã©${selectedPlaceTypes.size}‰∏™ÔºåËøòÂèØÈÄâÊã©${remaining}‰∏™`;
                hintElement.className = 'venue-hint active';
            } else {
                hintElement.textContent = `Â∑≤ÈÄâÊã©${selectedPlaceTypes.size}‰∏™Âú∫ÊôØÁ±ªÂûã`;
                hintElement.className = 'venue-hint limit';
            }
        }

        function addLocation() {
            const container = document.getElementById('locationsContainer');
            const locationInputs = container.querySelectorAll('.location-input');

            if (locationInputs.length >= 10) {
                showWarning('Â∑≤Ëææ‰∏äÈôê', 'ÊúÄÂ§öÊîØÊåÅ10‰∏™Âú∞ÁÇπ');
                return;
            }

            const inputId = `location-${locationIndex++}`;
            const newLocationDiv = document.createElement('div');
            newLocationDiv.className = 'location-input';
            newLocationDiv.setAttribute('data-index', locationIndex - 1);
            newLocationDiv.style.animationDelay = '0s';
            newLocationDiv.innerHTML = `
                <i class='bx bxs-location-plus'></i>
                <input type="text" name="location" id="${inputId}" placeholder="ËæìÂÖ•Âú∞ÁÇπ">
                <span class="coord-indicator"><i class='bx bx-check'></i></span>
                <button type="button" class="remove-location-btn" onclick="removeLocation(this)">
                    <i class='bx bx-x'></i>
                </button>
            `;
            container.appendChild(newLocationDiv);
            updateLocationCountHint();

            // Initialize autocomplete for the new input
            initAutocomplete(inputId);

            // Focus the new input
            newLocationDiv.querySelector('input').focus();
        }

        function updateLocationCountHint() {
            const container = document.getElementById('locationsContainer');
            const locationInputs = container.querySelectorAll('.location-input');
            const hintElement = document.getElementById('location-count-hint');
            if (!hintElement) return;

            const count = locationInputs.length;
            const remaining = 10 - count;

            if (count === 2) {
                hintElement.textContent = `Â∑≤ËæìÂÖ•${count}‰∏™Âú∞ÁÇπÔºåÂèØÊ∑ªÂä†Êõ¥Â§öÔºàÊúÄÂ§ö10‰∏™Ôºâ`;
                hintElement.className = 'location-hint';
            } else if (remaining > 0) {
                hintElement.textContent = `Â∑≤ËæìÂÖ•${count}‰∏™Âú∞ÁÇπÔºåËøòÂèØÊ∑ªÂä†${remaining}‰∏™`;
                hintElement.className = 'location-hint active';
            } else {
                hintElement.textContent = `Â∑≤ËæìÂÖ•${count}‰∏™Âú∞ÁÇπÔºàÂ∑≤Ëææ‰∏äÈôêÔºâ`;
                hintElement.className = 'location-hint limit';
            }
        }

        function removeLocation(button) {
            const locationInput = button.closest('.location-input');
            const container = document.getElementById('locationsContainer');
            const input = locationInput.querySelector('input');

            if (container.querySelectorAll('.location-input').length > 2) {
                // Clean up autocomplete instance and stored coords
                if (input && input.id) {
                    delete autocompleteInstances[input.id];
                    delete locationCoords[input.id];
                }
                locationInput.style.animation = 'slideInUp 0.3s ease-out reverse';
                setTimeout(() => {
                    locationInput.remove();
                    updateLocationCountHint();
                    updateStepIndicator();
                }, 280);
            } else {
                showWarning('Êó†Ê≥ïÂà†Èô§', 'Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏§‰∏™Âú∞ÁÇπ');
            }
        }

        function addRequirement(requirement) {
            const textarea = document.getElementById('userRequirements');
            const currentValue = textarea.value.trim();
            const requirementPattern = new RegExp(`‚Ä¢\\s*${requirement}\\s*`, 'g');

            if (requirementPattern.test(currentValue)) {
                textarea.value = currentValue.replace(requirementPattern, '').replace(/\n\s*\n/g, '\n').trim();
                updateRequirementButton(requirement, false);
            } else {
                textarea.value = currentValue ? currentValue + '\n‚Ä¢ ' + requirement : '‚Ä¢ ' + requirement;
                updateRequirementButton(requirement, true);
            }
        }

        function updateRequirementButton(requirement, isSelected) {
            document.querySelectorAll('.suggestion-tag').forEach(button => {
                if (button.textContent.trim() === requirement) {
                    button.classList.toggle('selected', isSelected);
                }
            });
        }

        // Agent Thinking Animation Controller
        const ThinkingAnimator = {
            currentStep: 0,
            totalSteps: 5,
            animationInterval: null,
            isComplete: false,

            // Reset all steps to initial state
            reset() {
                this.currentStep = 0;
                this.isComplete = false;
                if (this.animationInterval) {
                    clearInterval(this.animationInterval);
                    this.animationInterval = null;
                }
                document.querySelectorAll('.thinking-step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                const progressBar = document.getElementById('loadingProgressBar');
                if (progressBar) progressBar.style.width = '0%';
            },

            // Activate a specific step
            activateStep(stepNum) {
                const steps = document.querySelectorAll('.thinking-step');
                steps.forEach((step, index) => {
                    const num = index + 1;
                    if (num < stepNum) {
                        step.classList.remove('active');
                        step.classList.add('completed');
                    } else if (num === stepNum) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });

                // Update progress bar
                const progressBar = document.getElementById('loadingProgressBar');
                if (progressBar) {
                    const progress = ((stepNum - 1) / this.totalSteps) * 100 + 10;
                    progressBar.style.width = Math.min(progress, 90) + '%';
                }
            },

            // Start the animation sequence
            start() {
                this.reset();
                this.currentStep = 1;
                this.activateStep(1);

                // Auto-advance steps with varying intervals
                const stepDurations = [600, 500, 700, 600, 500]; // Duration for each step
                let stepIndex = 0;

                const advanceStep = () => {
                    if (this.isComplete || stepIndex >= this.totalSteps - 1) return;
                    stepIndex++;
                    this.currentStep = stepIndex + 1;
                    this.activateStep(this.currentStep);

                    if (stepIndex < this.totalSteps - 1) {
                        setTimeout(advanceStep, stepDurations[stepIndex] || 500);
                    }
                };

                setTimeout(advanceStep, stepDurations[0]);
            },

            // Complete all steps (called when API responds)
            complete(mode) {
                this.isComplete = true;

                // Complete all steps
                document.querySelectorAll('.thinking-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });

                // Update progress bar to 100%
                const progressBar = document.getElementById('loadingProgressBar');
                if (progressBar) progressBar.style.width = '100%';

                // Update title based on mode
                const loadingTitle = document.getElementById('loadingTitle');
                const loadingText = document.getElementById('loadingText');

                if (mode === 'agent') {
                    if (loadingTitle) loadingTitle.textContent = 'Agent Ê∑±Â∫¶ÂàÜÊûêÂÆåÊàê';
                    if (loadingText) loadingText.textContent = 'Â∑≤‰∏∫ÊÇ®ÁîüÊàê‰∏™ÊÄßÂåñÊé®ËçêÊñπÊ°à';
                } else {
                    if (loadingTitle) loadingTitle.textContent = 'Âø´ÈÄüÊé®ËçêÂÆåÊàê';
                    if (loadingText) loadingText.textContent = 'Â∑≤‰∏∫ÊÇ®ÊâæÂà∞ÊúÄ‰Ω≥‰ºöÈù¢ÁÇπ';
                }
            }
        };

        // Form submission
        document.getElementById('meetspotForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');

            const locationInputs = document.querySelectorAll('input[name="location"]');
            let locations = [];
            let coordsArray = [];  // Collect pre-resolved coordinates

            // Collect locations and their coordinates
            Array.from(locationInputs).forEach(input => {
                const value = input.value.trim();
                if (value) {
                    // Check if this input has pre-resolved coordinates
                    const inputId = input.id;
                    if (inputId && locationCoords[inputId] && locationCoords[inputId].name === value) {
                        // Use the pre-resolved coordinate
                        locations.push(value);
                        coordsArray.push(locationCoords[inputId]);
                    } else if (value.includes(' ') && !value.includes('Âå∫') && !value.includes('Â∏Ç') && !value.includes('Âéø')) {
                        // Split space-separated locations (no coords for these)
                        const splitLocs = value.split(/\s+/).filter(loc => loc.trim());
                        splitLocs.forEach(loc => {
                            locations.push(loc);
                            coordsArray.push(null);  // No pre-resolved coord
                        });
                    } else {
                        locations.push(value);
                        coordsArray.push(null);  // No pre-resolved coord
                    }
                }
            });

            locations = [...new Set(locations)];

            if (locations.length < 2) {
                showError('Âú∞ÁÇπ‰∏çË∂≥', 'ËØ∑Ëá≥Â∞ëËæìÂÖ•‰∏§‰∏™Âú∞ÁÇπ');
                return;
            }

            if (locations.length > 10) {
                showError('Âú∞ÁÇπËøáÂ§ö', 'ÊúÄÂ§öÊîØÊåÅ10‰∏™Âú∞ÁÇπ');
                return;
            }

            // Only send location_coords if ALL locations have pre-resolved coordinates
            // This ensures we don't mix pre-resolved and geocoded results
            let location_coords = null;
            const validCoords = coordsArray.filter(c => c !== null);
            if (validCoords.length === locations.length) {
                // All locations have pre-resolved coordinates
                location_coords = validCoords;
                console.log('All locations have pre-resolved coordinates:', location_coords);
            } else if (validCoords.length > 0) {
                console.log(`${validCoords.length}/${locations.length} locations have pre-resolved coordinates, falling back to geocoding for all`);
            }

            let keywords = '';
            let selectedTheme = '';
            const customKeywords = document.getElementById('customKeywords').value.trim();

            if (customKeywords) {
                keywords = customKeywords;
                selectedTheme = 'custom';
            } else if (selectedPlaceTypes.size > 0) {
                keywords = Array.from(selectedPlaceTypes).join(' ');
                selectedTheme = selectedThemeOrder.length > 0 ? selectedThemeOrder[0] : '';
            } else {
                keywords = 'ÂíñÂï°È¶Ü';
                selectedTheme = 'coffee';
            }

            const userRequirements = document.getElementById('userRequirements').value.trim();

            submitBtn.disabled = true;
            // Update loading text with specific keywords
            document.getElementById('loadingTitle').textContent = 'Êô∫ËÉΩÂàÜÊûê‰∏≠';
            document.getElementById('loadingText').textContent = `Ê≠£Âú®‰∏∫ÊÇ®Êé®Ëçê${keywords}...`;
            loading.style.display = 'block';

            // Start the thinking animation
            ThinkingAnimator.start();

            try {
                // Ëé∑ÂèñÁ≠õÈÄâÊù°‰ª∂
                const minRating = parseFloat(document.getElementById('minRating').value) || 0;
                const maxDistance = parseInt(document.getElementById('maxDistance').value) || 100000;
                const priceRange = document.getElementById('priceRange').value || "";

                // Build request body
                const requestBody = {
                    locations: locations,
                    keywords: keywords,
                    user_requirements: userRequirements,
                    theme: selectedTheme,
                    min_rating: minRating,
                    max_distance: maxDistance,
                    price_range: priceRange
                };

                // Add pre-resolved coordinates if available
                if (location_coords) {
                    requestBody.location_coords = location_coords;
                }

                if (typeof _hmt !== "undefined") {
                    _hmt.push(["_trackEvent", "meetspot", "tool_submit",
                        keywords, locations.length]);
                }

                const _submitTime = Date.now();
                const response = await fetch('/api/find_meetspot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}`);
                }

                const result = await response.json();

                // Complete the animation with mode info
                const mode = result.mode || 'rule_llm';
                ThinkingAnimator.complete(mode);

                if (result.success && result.html_url) {
                    if (typeof _hmt !== "undefined") {
                        _hmt.push(["_trackEvent", "meetspot", "recommendation_result",
                            mode, Date.now() - _submitTime]);
                    }
                    // Show mode-aware success message
                    const modeText = mode === 'agent' ? 'Agent Ê∑±Â∫¶ÂàÜÊûê' : 'Âø´ÈÄüÊé®Ëçê';
                    showSuccess(`${modeText}ÂÆåÊàê`, `${keywords}Êé®ËçêÂ∑≤ÁîüÊàêÔºåÊ≠£Âú®Ë∑≥ËΩ¨...`);
                    setTimeout(() => {
                        window.location.href = result.html_url;
                    }, 800);
                } else if (result.success && !result.html_url) {
                    showWarning('Êú™ÊâæÂà∞ÁªìÊûú', 'ËØ∑Â∞ùËØïÊõ¥Êç¢ÂÖ≥ÈîÆËØçÊàñ‰ΩøÁî®Êõ¥ËØ¶ÁªÜÁöÑÂú∞ÂùÄ');
                } else {
                    throw new Error(result.error || 'Â§ÑÁêÜÂºÇÂ∏∏');
                }
            } catch (error) {
                ThinkingAnimator.reset();
                showError('ËØ∑Ê±ÇÂ§±Ë¥•', error.message || 'ËØ∑ÈáçËØï');
            } finally {
                submitBtn.disabled = false;
                // Don't hide loading immediately on success - let the redirect happen
                if (!document.getElementById('loading').dataset.success) {
                    loading.style.display = 'none';
                }
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePlaceTypeHint();
            updateLocationCountHint();

            // Default select coffee
            const cafeType = document.querySelector('.place-type[data-type="ÂíñÂï°È¶Ü"]');
            if (cafeType) {
                cafeType.click();
            }

            // Load AMap API for autocomplete
            loadAMapAPI()
                .then(() => {
                    console.log('Address autocomplete ready');
                })
                .catch(err => {
                    console.warn('Address autocomplete not available:', err);
                });
        });
    </script>

    <!-- Modern Toast Notification System -->
    <script src="/public/js/toast.js"></script>
</body>
</html>
